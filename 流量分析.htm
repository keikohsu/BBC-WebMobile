<div class="admweb-v2-orderlist-header">
  <div class="admweb-v2-orderlist-header-actions">
    <button onclick="history.back()">
      <i class="icons-line icon-arrow-left-01"></i>
    </button>
    <button onclick="toggleMenuHandler()">
      <i class="icons-line icon-line-hamburger"></i>
    </button>
  </div>
  <h2 class="admweb-v2-orderlist-header-title">流量分析</h2>
  <span></span>
</div>
<div class="pic-default pic-flex admweb-v2-order_detail">
  <div class="admweb-v2-seller-front-left-box">
    {{include file="admweb_2/admweb.main_menu.htm"}}
  </div>
  <div class="admweb-v2-orderlist__inner pic-text-gray-100">
    <section class="admweb-v2-analysis__content">
      <h1 class="admweb-v2-analysis__title">
        流量分析
        <button onclick="openAlert('case2')">
          <i
            class="icons-line icon-line-Help pic-text-gray-40"
            style="font-size: 15px"
          ></i>
        </button>
      </h1>
      <fieldset class="pic-margin-t10 pic-margin-b10" data-input-fieldset>
        <div class="admweb-v2-store_delivery__fieldset">
          <legend class="admweb-v2-store_delivery__fieldset-legend">
            <span data-input-legend>資料時間</span>
            <!-- openPopupHandler 傳入 要監聽的input name -->
            <div
              class="admweb-v2-store_delivery__popup-btn"
              onclick="openPopupHandler(this,'search-interval')"
            >
              <span data-input-text>過去7天</span>
              <i class="icons-line icon-arrow-right-01"></i>
            </div>
          </legend>
          <div class="admweb-v2-analysis__serach-field">
            <div
              class="
                admweb-v2-store_delivery__fieldset-fields-type1
                admweb-v2-sp-hidden
              "
              data-input-fields
            >
              <select
                name="search-interval"
                id=""
                class="
                  pic-text-lnput pic-text-lnput-style
                  admweb-v2-orderlist-select
                "
                style="max-width: 500px"
              >
                <option value="過去7天">過去7天</option>
                <option value="過去30天">過去30天</option>
                <option value="自訂時間">自訂時間</option>
              </select>
            </div>
            <div
              class="
                admweb-v2-orderlist__form-range_date
                js-admweb-v2__range_date
                admweb-v2-analysis__range_date
              "
              style="display: none"
            >
              <span class="admweb-v2-orderlist__form-date">
                <input
                type="text-date"
                name="date-start"
                class="
                  pic-text-lnput pic-lnput-enter
                "
              />
              </span>

              <span>-</span>
              <span class="admweb-v2-orderlist__form-date">
                <input
                type="text-date"
                name="date-end"
                class="
                  pic-text-lnput pic-lnput-enter
                "
              />
            </div>
          </div>
        </div>
      </fieldset>
      <!-- 網站流量  -->
      <h4 class="admweb-v2-analysis__chart-head">網站流量</h4>
      <section class="admweb-v2-analysis__check_list">
        <div class="admweb-v2-analysis__check_item">
          <input
            type="checkbox"
            name="line-checkbox"
            id="line-chart1"
            checked
            disabled
          />
          <label for="line-chart1" style="--check-color: var(--pic-red)">
            <p>總瀏覽量</p>
            <p class="admweb-v2-analysis__check_item-num">29,875,379</p>
          </label>
        </div>
        <div class="admweb-v2-analysis__check_item">
          <input type="checkbox" name="line-traffic" id="line-chart2" />
          <label for="line-chart2" style="--check-color: var(--pic-green)">
            <p>網站流覽量</p>
            <p class="admweb-v2-analysis__check_item-num">9,935,759</p>
          </label>
        </div>
        <div class="admweb-v2-analysis__check_item">
          <input type="checkbox" name="line-traffic" id="line-chart3" />
          <label for="line-chart3" style="--check-color: var(--pic-green)">
            <p>APP瀏覽量</p>
            <p class="admweb-v2-analysis__check_item-num">19,875,379</p>
          </label>
        </div>
      </section>
      <h4 class="admweb-v2-analysis__chart-head">總覽</h4>
      <section>
        <p
          class="pic-text-gray-70 pic-font-size-12 pic-text-right"
          id="line-traffic-selected"
        >
          已選1/2
        </p>
        <canvas
          id="line-traffic"
          class="admweb-v2-analysis__canvas-line"
        ></canvas>
        <div class="admweb-v2-analysis__canvas-info">
          <header>2022/10/28</header>
          <div class="admweb-v2-analysis__canvas-info--box">
            <div class="admweb-v2-analysis__canvas-info--item">
              <span
                class="admweb-v2-analysis__deco-device"
                style="--deco-color: var(--pic-red)"
                >總流覽量</span
              >
              <p class="admweb-v2-analysis__canvas-num">19,935,759</p>
            </div>
            <div class="admweb-v2-analysis__canvas-info--item">
              <span
                class="admweb-v2-analysis__deco-device"
                style="--deco-color: var(--pic-green)"
                >網站流覽量</span
              >
              <p class="admweb-v2-analysis__canvas-num">19,935,759</p>
            </div>
          </div>
        </div>
      </section>

      <h4 class="admweb-v2-analysis__chart-head">使用裝置</h4>
      <section class="admweb-v2-analysis__layout-box">
        <canvas
          id="doughnut-device"
          class="admweb-v2-analysis__canvas-doughnut"
        ></canvas>
        <table class="admweb-v2-analysis__chart_table">
          <thead class="admweb-v2-analysis__chart_table-head">
            <tr>
              <th>裝置類別</th>
              <th>瀏覽人次</th>
              <th>瀏覽人次%</th>
            </tr>
          </thead>
          <tbody class="admweb-v2-analysis__chart_table-body">
            <tr>
              <td>
                <span
                  class="admweb-v2-analysis__deco-device"
                  style="--deco-color: var(--pic-green)"
                  >行動裝置</span
                >
              </td>
              <td>10,728,759</td>
              <td>91.7%</td>
            </tr>
            <tr>
              <td>
                <span
                  class="admweb-v2-analysis__deco-device"
                  style="--deco-color: var(--pic-orange)"
                  >桌機</span
                >
              </td>
              <td>935,759</td>
              <td>8.0%</td>
            </tr>
            <tr>
              <td>
                <span
                  class="admweb-v2-analysis__deco-device"
                  style="--deco-color: var(--pic-red)"
                  >平板</span
                >
              </td>
              <td>35,759</td>
              <td>0.3%</td>
            </tr>
          </tbody>
        </table>
      </section>
      <div class="admweb-v2-analysis__table-foot pic-margin-t10">
        <p>資料時間 2022/10/14 22:51:28</p>
        <p>更新日期 2022/09/28 ~ 2022/10/14</p>
      </div>
    </section>
    <section class="admweb-v2-analysis__content">
      <h1 class="admweb-v2-analysis__title">
        訪客分析
        <button onclick="openAlert('case2')">
          <i
            class="icons-line icon-line-Help pic-text-gray-40"
            style="font-size: 15px"
          ></i>
        </button>
      </h1>
      <fieldset class="pic-margin-t5">
        <div class="admweb-v2-store_delivery__fieldset">
          <legend class="admweb-v2-store_delivery__fieldset-legend">
            項目類別
          </legend>
          <div
            class="
              admweb-v2-store_delivery__fieldset-fields-type1
              admweb-v2-analysis__fields--row
            "
          >
            <div class="admweb-v2-store_delivery__fieldset--radio">
              <label class="" for="all">
                <input
                  class="admweb-v2-radio-green"
                  type="radio"
                  id="all"
                  name="shipment"
                  value="全部"
                  checked
                />
                <div class="admweb-v2-label-check-green"></div>
                <p>全部</p>
              </label>
            </div>
            <div class="admweb-v2-store_delivery__fieldset--radio">
              <label class="" for="website">
                <input
                  class="admweb-v2-radio-green"
                  type="radio"
                  id="website"
                  name="shipment"
                  value="網站"
                />
                <div class="admweb-v2-label-check-green"></div>
                <p>網站</p>
              </label>
            </div>
            <div class="admweb-v2-store_delivery__fieldset--radio">
              <label class="" for="APP">
                <input
                  class="admweb-v2-radio-green"
                  type="radio"
                  id="APP"
                  name="shipment"
                  value="APP"
                />
                <div class="admweb-v2-label-check-green"></div>
                <p>APP</p>
              </label>
            </div>
          </div>
        </div>
      </fieldset>
      <!-- 網站流量  -->
      <h4 class="admweb-v2-analysis__chart-head">網站流量</h4>
      <section class="admweb-v2-analysis__check_list">
        <div class="admweb-v2-analysis__check_item">
          <input
            type="checkbox"
            name="line2-checkbox"
            id="line2-chart1"
            checked
            disabled
          />
          <label for="line2-chart1" style="--check-color: var(--pic-red)">
            <p>不重複訪客數</p>
            <p class="admweb-v2-analysis__check_item-num">29,875,379</p>
          </label>
        </div>
        <div class="admweb-v2-analysis__check_item">
          <input type="checkbox" name="line-customer" id="line2-chart2" />
          <label for="line2-chart2" style="--check-color: var(--pic-green)">
            <p>新訪客數</p>
            <p class="admweb-v2-analysis__check_item-num">9,935,759</p>
          </label>
        </div>
        <div class="admweb-v2-analysis__check_item">
          <input type="checkbox" name="line-customer" id="line2-chart3" />
          <label for="line2-chart3" style="--check-color: var(--pic-green)">
            <p>既有的訪客數</p>
            <p class="admweb-v2-analysis__check_item-num">19,875,379</p>
          </label>
        </div>
        <div class="admweb-v2-analysis__check_item">
          <input type="checkbox" name="line-customer" id="line2-chart4" />
          <label for="line2-chart4" style="--check-color: var(--pic-green)">
            <p>平均停留時間</p>
            <p class="admweb-v2-analysis__check_item-num">19,875,379</p>
          </label>
        </div>
      </section>
      <h4 class="admweb-v2-analysis__chart-head">總覽</h4>
      <section>
        <p
          class="pic-text-gray-70 pic-font-size-12 pic-text-right"
          id="line-customer-selected"
        >
          已選1/2
        </p>
        <canvas
          id="line-customer"
          class="admweb-v2-analysis__canvas-line"
        ></canvas>
        <div class="admweb-v2-analysis__canvas-info">
          <header>2022/10/28</header>
          <div class="admweb-v2-analysis__canvas-info--box">
            <div class="admweb-v2-analysis__canvas-info--item">
              <span
                class="admweb-v2-analysis__deco-device"
                style="--deco-color: var(--pic-red)"
                >不重複訪客數</span
              >
              <p class="admweb-v2-analysis__canvas-num">19,935,759</p>
            </div>
            <div class="admweb-v2-analysis__canvas-info--item">
              <span
                class="admweb-v2-analysis__deco-device"
                style="--deco-color: var(--pic-green)"
                >既有的訪客數</span
              >
              <p class="admweb-v2-analysis__canvas-num">19,935,759</p>
            </div>
          </div>
        </div>
      </section>
      <div class="admweb-v2-analysis__table-foot">
        <p>資料時間 2022/10/14 22:51:28</p>
        <p>更新日期 2022/09/28 ~ 2022/10/14</p>
      </div>
    </section>
  </div>
  <div
    class="admweb-v2__popup js-admweb-v2__popup"
    style="display: none"
    onclick="closePopup()"
  >
    <div class="admweb-v2__popup--inner js-admweb-v2__popup--inner">
      <h3 class="admweb-v2__popup--title js-admweb-v2__popup--title">
        篩選區間
      </h3>
      <div class="admweb-v2__popup--content js-admweb-v2__popup--content">
        <div class="admweb-v2-store_delivery__fieldset--radio">
          <label class="" for="search-interval10">
            <input
              class="admweb-v2-radio-green"
              type="radio"
              id="search-interval10"
              name="search-interval"
              value="過去7天"
              checked=""
            />

            <div class="admweb-v2-label-check-green"></div>
            <p>過去7天</p>
          </label>
        </div>
        <div class="admweb-v2-store_delivery__fieldset--radio">
          <label class="" for="search-interval21">
            <input
              class="admweb-v2-radio-green"
              type="radio"
              id="search-interval21"
              name="search-interval"
              value="過去30天"
            />

            <div class="admweb-v2-label-check-green"></div>
            <p>過去30天</p>
          </label>
        </div>
        <div class="admweb-v2-store_delivery__fieldset--radio">
          <label class="" for="search-interval31">
            <input
              class="admweb-v2-radio-green"
              type="radio"
              id="search-interval31"
              name="search-interval"
              value="自訂時間"
            />

            <div class="admweb-v2-label-check-green"></div>
            <p>自訂時間</p>
          </label>
        </div>
      </div>
      <div
        class="
          js-admweb-v2__popup--action
          pic-confirm-box pic-flex-center pic-icon-margin-r pic-line-light15
        "
      >
        <button
          onclick="confirmPopup('search-interval')"
          class="
            pic-btn-newstore-100 pic-BgText-color-green pic-icon-white-check
          "
        >
          確定
        </button>
      </div>
    </div>
  </div>
</div>
<script src="{{$sys_arrWebsite.website_url}}javascripts/chart.umd.js"></script>
<script>
  (function () {
    hideMobileLayout();
    getPcSideMenuWidth();
  })();
  function getPcSideMenuWidth() {
    const pcSidMenuEle = document.querySelector(
      '.admweb-v2-seller-front-left-box'
    );
    pcSidMenuEle
      .closest('.admweb-v2-order_detail')
      .style.setProperty('--side-menu-width', pcSidMenuEle.clientWidth + 'px');
  }
  function toggleMenuHandler() {
    document
      .querySelector('.admweb-v2-seller-front-left-box')
      .classList.toggle('pic-phone-open-menu');
    const hamBtn = document
      .querySelectorAll('.admweb-v2-orderlist-header-actions button')[1]
      .querySelector('i');
    if (hamBtn.classList.contains('icon-arrow-left-01')) {
      document.querySelectorAll(
        '.admweb-v2-orderlist-header-actions button'
      )[0].style.display = 'block';
    } else {
      document.querySelectorAll(
        '.admweb-v2-orderlist-header-actions button'
      )[0].style.display = 'none';
    }
    hamBtn.classList.toggle('icon-arrow-left-01');
  }
  function hideMobileLayout() {
    if (window.matchMedia('(max-width: 768px)').matches) {
      document.querySelector(
        '.admweb-v2-list-header-in-fixbottom'
      ).style.display = 'none';
      document.querySelector('.admweb-v2-list-header').style.display = 'none';
    }
  }
  // 自訂時間
  const searchInputs = document.querySelectorAll('[name=search-interval]');
  searchInputs.forEach((input) =>
    input.addEventListener('change', () => {
      const dateInputs = document.querySelectorAll('.js-admweb-v2__range_date');
      if (input.value === '自訂時間') {
        dateInputs.forEach((date) => (date.style.display = 'flex'));
      } else {
        dateInputs.forEach((date) => (date.style.display = 'none'));
      }
    })
  );
  // popup
  function openPopupHandler(ele, inputName) {
    const filedsetEle = ele.closest('[data-input-fieldset]');
    const textEle = ele.querySelector('[data-input-text]');
    const legendEle = filedsetEle.querySelector('[data-input-legend]');
    const fieldEles = filedsetEle.querySelectorAll('[data-input-fields] > *');
    $('.js-admweb-v2__popup').show();
    $('.js-admweb-v2__popup--inner').slideDown();
  }
  function confirmPopup(inputName) {
    $('.js-admweb-v2__popup--inner').slideUp();
    $('.js-admweb-v2__popup').hide();
    updatePopupText(inputName);
  }
  const popupEle = document.querySelector('.js-admweb-v2__popup--inner');
  popupEle.addEventListener('click', (event) => {
    event.stopPropagation();
  });
  function closePopup() {
    $('.js-admweb-v2__popup--inner').slideUp();
    $('.js-admweb-v2__popup').hide();
  }
  function updatePopupText(inputName) {
    const inputEles = document.querySelectorAll(`input[name=${inputName}]`);
    const filedsetEle = document
      .querySelector(`select[name=${inputName}]`)
      .closest('[data-input-fieldset]');
    const textEle = filedsetEle.querySelector('[data-input-text]');
    textEle.innerText = Array.from(inputEles).find(
      (input) => input.checked
    ).value;
  }

  // chart.js
  const lineData = {
    labels: ['3/1', '3/2', '3/3', '3/4', '3/5', '3/6'],
    datasets: [
      {
        label: 'Dataset 1',
        data: [300, 20, 100, 30, 55, 44],
        borderColor: '#ED2525',
        backgroundColor: '#ED2525'
      }
    ]
  };
  const lineConfig = {
    type: 'line',
    data: lineData,
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false
        },
        title: {
          display: false
        }
      },
      borderWidth: 1,
      pointHoverBorderWidth: 8,
      borderStyle: 'dotted',
      scales: {
        x: {
          grid: {
            color: '#fff',
            tickColor: '#fff',
            tickWidth: 1
          },
          ticks: {
            color: '#ACACAC'
          },
          border: {
            dash: [2, 2]
          }
        },
        y: {
          grid: {
            color: '#EAEAEA',
            tickColor: '#fff'
          },
          border: {
            dash: [2, 2]
          },
          ticks: {
            display: false,
            color: '#fff'
          }
        }
      }
    },
    plugins: [
      {
        beforeDraw: (chart) => {
          if (chart.tooltip?._active?.length) {
            let x = chart.tooltip._active[0].element.x;
            let yAxis = chart.scales.y;
            let ctx = chart.ctx;
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(x, yAxis.top);
            ctx.lineTo(x, yAxis.bottom);
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#EAEAEA';
            ctx.stroke();
            ctx.restore();
          }
        }
      }
    ]
  };

  var lineChart = new Chart('line-traffic', lineConfig);
  var line2Chart = new Chart('line-customer', lineConfig);
  function toggleDataset(index, chart, checked) {
    const newDataset = [
      {
        label: '網站瀏覽量',
        data: [44, 78, 37, 133, 90, 55],
        borderColor: '#008062',
        backgroundColor: '#008062'
      },
      {
        label: 'APP瀏覽量',
        data: [133, 90, 55, 44, 78, 37],
        borderColor: '#008062',
        backgroundColor: '#008062'
      },

      {
        label: '平均停留時間',
        data: [133, 90, 55, 55, 28, 44],
        borderColor: '#008062',
        backgroundColor: '#008062'
      }
    ];
    if (checked) {
      lineData.datasets.length > 1 && lineData.datasets.pop();
      lineData.datasets.push(newDataset[index]);
    } else {
      lineData.datasets.pop();
    }
    chart.update();
  }
  function updateText(name, count) {
    const ele = document.getElementById(`${name}-selected`);
    ele.innerText = `已選${1 + count}/2`;
  }
  function watchDatasetChange(name, chart) {
    const inputs = document.querySelectorAll(`input[name=${name}]`);
    let checkedIndex = null;
    let count = 0;
    inputs.forEach((input, i) => {
      input.addEventListener('change', () => {
        const inputChecked = document.querySelectorAll(
          `input[name=${name}]:checked`
        );
        // 已選擇下 點其他checkbox
        if (inputChecked.length > 1 && checkedIndex !== i) {
          inputs.forEach((item) => (item.checked = false));
          input.checked = true;
        } else if (inputChecked.length > 1) {
          inputs.forEach((item) => (item.checked = false));
        } else if (input.checked) {
          count++;
        } else {
          count = count-- < 0 ? 0 : count--;
        }
        checkedIndex = i;
        const checked = input.checked;
        toggleDataset(i, chart, checked);
        updateText(name, count);
      });
    });
  }
  watchDatasetChange('line-traffic', lineChart);
  watchDatasetChange('line-customer', line2Chart);

  //圓餅圖
  const doughnutData = {
    labels: ['行動裝置', '桌機', '平板'],
    datasets: [
      {
        label: ['行動裝置', '桌機', '平板'],
        data: [100, 50, 10],
        backgroundColor: ['#008062', '#F37721', '#ED2525']
      }
    ]
  };
  const doughnutConfig = {
    type: 'doughnut',
    data: doughnutData,
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false
        },
        title: {
          display: false
        }
      }
    }
  };
  var doughnutChart = new Chart(
    document.getElementById('doughnut-device'),
    doughnutConfig
  );
  // datepicker
  $(function () {
    $("input[type='text-date']").datepicker({
      dateFormat: 'yy/mm/dd',
      changeYear: true,
      changeMonth: true,
      monthNamesShort: [
        '一月',
        '二月',
        '三月',
        '四月',
        '五月',
        '六月',
        '七月',
        '八月',
        '九月',
        '十月',
        '十一月',
        '十二月'
      ],
      dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],
      minDate: null
    });
  });
</script>
