<style>
  .pic-window-bg .pic-window { width: 333px;}
  .pic-window-button-box > a,
  .admweb-v2-I-Btn{ cursor: pointer;}
  .admweb-v2-marketing{ padding-top: 72px;}
  .admweb-v2-marketing .admweb-v2-marketing-inner{ font-size: 14px; overflow-x: auto; flex-grow: 1; background: var(--pic-color-grey-10); position: relative;color: var(--pic-color-grey-100); min-height: calc(100vh - 60px - 62px);}
  
  /* 溫層按鈕 */
  .admweb-v2-orderlist__badge--refrigeration, .admweb-v2-orderlist-refrigeration--store,
  .admweb-v2-orderlist__badge--freezing, .admweb-v2-orderlist-freezing--store{ margin: 0 auto;}

  /* 搜尋 */
  .admweb-v2-marketing .admweb-v2-marketing-form { background: var(--pic-light-green-5); padding: 10px; padding-bottom: 0; overflow: hidden; margin-bottom: 0; transition: height 0.3s ease-in-out; box-sizing: content-box; }
  .admweb-v2-marketing .admweb-v2-input-date-content .admweb-v2-DateBox{ width: calc(100% / 2);}
  .admweb-v2-marketing .admweb-v2-marketing-form-item{ display: grid; grid-template-columns: 60px 1fr; align-items: center; gap: 5px; }
  .admweb-v2-marketing .admweb-v2-marketing-form-item:last-of-type{ grid-column-end: 4; grid-column-start: 1;}
  .admweb-v2-marketing .admweb-v2-marketing-form-toggle-btn { width: 100%; border: none; display: block; padding: 6px; cursor: pointer; margin: 0;}
  .admweb-v2-marketing .admweb-v2-marketing-form-toggle-btn i {font-size: 20px; vertical-align: bottom;}
  .admweb-v2-marketing .admweb-v2-marketing-form-head_search { display: grid; grid-template-columns: auto 1fr 84px; gap: 5px; }
  .admweb-v2-marketing .admweb-v2-marketing-form-head_search-btn { padding: 10px; cursor: pointer; border-radius: 8px; }
  .admweb-v2-marketing .admweb-v2-marketing-form-btn { border-radius: 8px; display: block; width: 100%; cursor: pointer; }
  @media screen and (min-width: 768px){
      .admweb-v2-marketing .admweb-v2-marketing-form-head-search-outer{ display: grid; grid-template-columns: repeat(4,minmax(0,1fr)); gap: 5px;}
      .admweb-v2-marketing .admweb-v2-marketing-form-head_search{ grid-area: 1/1/2/5; }
      .admweb-v2-marketing .admweb-v2-marketing-form-head_search + div{ grid-area: 2/1/3/5 }
      .admweb-v2-marketing .admweb-v2-marketing-form div + div{ margin: 0; }
  }

  /* 清單 */
  .admweb-v2-marketing .admweb-v2-marketing-list{ background: var(--pic-color-grey-10); list-style: none; padding: 0 10px; }
  .admweb-v2-marketing .admweb-v2-marketing-card{ background: #FFFFFF; border-radius: 10px; padding: 10px;}
  .admweb-v2-marketing .admweb-v2-marketing-card + .admweb-v2-marketing-card { margin: 10px 0; }
  .admweb-v2-marketing .admweb-v2-marketing-table{ font-size: 14px; text-align: center; width: 100%; display: none; }
  .admweb-v2-marketing .admweb-v2-marketing-table-head { color:var(--pic-color-grey-60) }
  .admweb-v2-marketing .admweb-v2-marketing-table-head th{ background: var(--pic-color-grey-5); padding:12px 5px; font-weight: normal; }
  .admweb-v2-marketing .admweb-v2-marketing-table-head th:first-child{ border-radius: 8px 0px 0px 0px; }
  .admweb-v2-marketing .admweb-v2-marketing-table-head th:last-child{ border-radius: 0px 8px 0px 0px; }
  .admweb-v2-marketing .admweb-v2-marketing-table-tr td{ padding: 8px;}
  .admweb-v2-marketing .admweb-v2-marketing-table tr th:first-of-type,
  .admweb-v2-marketing .admweb-v2-marketing-table tr td:first-of-type{ width: calc(100% - 785px);}
  .admweb-v2-marketing .admweb-v2-marketing-table tr th:nth-child(2),
  .admweb-v2-marketing .admweb-v2-marketing-table tr td:nth-child(2){ width: 200px;}
  .admweb-v2-marketing .admweb-v2-marketing-table tr th:nth-child(3),
  .admweb-v2-marketing .admweb-v2-marketing-table tr td:nth-child(3){ width: 200px;}
  .admweb-v2-marketing .admweb-v2-marketing-table tr th:nth-child(4),
  .admweb-v2-marketing .admweb-v2-marketing-table tr td:nth-child(4){ width: 260px;}
  .admweb-v2-marketing .admweb-v2-marketing-table tr th:nth-child(5),
  .admweb-v2-marketing .admweb-v2-marketing-table tr td:nth-child(5){ width: 125px;}
  .admweb-v2-marketing .admweb-v2-marketing-table tr .admweb-v2-marketing-name{ overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;}
  .admweb-v2-marketing .admweb-v2-marketing-table tr .admweb-v2-marketing-type-text { margin-top: 5px; font-size: 14px; }
  @media screen and (min-width: 768px){
      .admweb-v2-marketing .admweb-v2-marketing-table{ display: table; }
      .admweb-v2-marketing .admweb-v2-marketing-card-top,
      .admweb-v2-marketing .admweb-v2-marketing-card-detail{ display: none; }
      .admweb-v2-marketing .admweb-v2-marketing-table tr td:nth-child(4),.admweb-v2-marketing .admweb-v2-marketing-table tr td:nth-child(3){white-space: nowrap;}
  }

  /* tag */
  .admweb-v2-marketing-tag-marketing-type{ background:var(--pic-light-red-5); border: 1px solid var(--pic-light-red-20); border-radius: 5px; padding: 5px 6px; color: var(--pic-red); font-size: 12px; display: inline-block;}
  .admweb-v2-marketing-tag-marketing-type i.icons-line{ font-size: 16px; font-weight: normal; margin-right: 2px;}
  .admweb-v2-marketing-tag-status-valid{ background:var(--pic-light-red-5); border: 1px solid var(--pic-light-red-20); border-radius: 5px; padding: 5px 6px; color: var(--pic-red); font-size: 12px; display: inline-block;}
  .admweb-v2-marketing-tag-status-invalid{ background:var(--pic-color-grey-5); border: 1px solid var(--pic-color-grey-20); border-radius: 5px; padding: 5px 6px; color: var(--pic-color-grey-30); font-size: 12px; display: inline-block;}

  /* 置底按鈕 */
  .pic-confirm-box{ margin: 0;}
  .admweb-v2-marketing-action { display: flex; justify-content: flex-end; width: calc(100% - 250px); background-color: #fff; border-top: 0.5px solid rgba(60, 60, 67, 0.36); padding: 10px 15px; position: fixed; bottom: 0; }
  .admweb-v2-marketing-action i.icons-line { font-weight: normal; font-size: 13px; }
  .admweb-v2-marketing-action > button { display: flex; justify-content: center; align-items: center; gap: 3px 5px; background: var(--pic-green); color: #fff; padding: 3px 5px; border: none; border-radius: 6px; cursor: pointer;}
  .admweb-v2-marketing-action-row_btn { flex-direction: row; flex-grow: 1; }
  @media screen and (min-width: 768px){
      .admweb-v2-marketing-action-row_btn{ flex-direction: row; flex-grow: 0; padding: 10px 12px; }
      .admweb-v2-marketing-action > button{ font-size: 16px; padding: 10px 12px; }
      .admweb-v2-marketing-action i.icons-line{ font-size: 16px; }
  }
</style>
<div class="pic-default pic-flex admweb-v2-marketing">
  <!-- 左側選單 Start -->
  <div class="admweb-v2-seller-front-left-box">
      {{include file="admweb_2/admweb.main_menu.htm"}}
  </div>
  <!-- 左側選單 End -->

  <!-- 右側內容 Start -->
  <div class="admweb-v2-adjustment">
      <div class="admweb-v2-marketing-inner">
          <!-- 搜尋 -->
          <!--<form class="admweb-v2-marketing-form js-marketing-form">
              <div class="admweb-v2-marketing-form-head-search-outer">
                  <div class="admweb-v2-marketing-form-head_search js-marketing-form-head-search" style="grid-template-columns: auto 1fr 84px;">
                      <select name="keyword_type" class="pic-text-lnput pic-text-lnput-style" style="width: 127px;">
                          <option value="活動名稱">活動名稱</option>
                          <option value="商品名稱">商品名稱</option>
                      </select>
                      <input type="text" placeholder="請輸入活動名稱" class="pic-text-lnput pic-lnput-enter">
                      <button type="submit" class="iopen-search pic-BgText-color-green admweb-v2-marketing-form-head_search-btn js-marketing-form-head-search-btn" style="display: block;"> 搜尋 </button>
                  </div>
                  <div class="admweb-v2-marketing-form-item">
                      <label for="order-date">活動時間</label>
                      <div class="admweb-v2-input-date-content">
                          <span class="admweb-v2-DateBox iopen-icon-date pic-margin-r5">
                              <input name="CgdmStartDatetime" class="pic-text-lnput" type="text" value="2023/01/04">
                          </span>
                          <span class="pic-margin-r5">-</span>
                          <span class="admweb-v2-DateBox iopen-icon-date">
                              <input name="CgdmStartDatetime" class="pic-text-lnput" type="text" value="2023/01/04">
                          </span>
                      </div>
                  </div>
                  <button type="submit" class="iopen-search pic-BgText-color-green admweb-v2-marketing-form-btn">搜尋</button>
              </div>
              <input type="hidden" name="csrf_token" value="MTY3NTMyMzczMUJkcVFRWTBOMXRjclQ0M0tuQkpwY0NvOVRqQUp2b2dj">
          </form>
          <button class=" pic-text-gray-30 pic-bg-green-5 admweb-v2-marketing-form-toggle-btn" id="js-marketing-form-toggle--btn">更多進階條件 <i class="icons-line icon-arrow-down-01"></i></button>
        -->
          <!-- 頁籤 -->
          <div class="pic-common-navbarbox pic-common-navbarbox-tow-width-50">
              <div class="swiper-container pic-navbar" id="pic-navbar">
                  <div class="swiper-wrapper pic-nav-list">
                      <div id="swiper-tab-1" class="swiper-slide pic-nav-a" timeCheck="1"><span>進行中</span></div>
                      <div id="swiper-tab-2" class="swiper-slide pic-nav-a" timeCheck="2"><span>即將開始</span></div>
                      <div id="swiper-tab-3" class="swiper-slide pic-nav-a" timeCheck="3"><span>已結束</span></div>
                  </div>
              </div>
          </div>
          <!-- 清單 -->
          <div class="pic-bg-orange-10 pic-text-orange admweb-v2-orderlist__notice--outer">
            <div class="admweb-v2-orderlist__notice">
              <p>消費者購物車內只要有加入"免運商品"且購物車金額達免運門檻，整筆訂單即免運。</p>
            </div>
          </div>
          <p class="admweb-v2-FewStrokes pic-margin-10">
              <span class="pic-margin-r10">
                  <text style="display: none;">活動日期：2022/09/05 ~ 2022/10/05</text>
              </span> <text id="total">共{{$m_arrWebsiteDeliveryFreeEventTotal}}筆</text>
          </p>
          <ul class="admweb-v2-marketing-list pic-margin-b20">
              {{if $m_arrWebsiteDeliveryFreeEvent|@count > 0}}
              {{foreach from=$m_arrWebsiteDeliveryFreeEvent item=m_arrWDFE}}
              <li class="admweb-v2-marketing-card">
                  <table class="admweb-v2-marketing-table">
                      <thead>
                      <tr class="admweb-v2-marketing-table-head">
                          <th>活動名稱</th>
                          <th>運送溫層</th>
                          <th>運送方式</th>
                          <th>活動時間</th>
                          <th>狀態</th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr class="admweb-v2-marketing-table-tr">
                          <td><!--活動名稱-->
                              <div class="admweb-v2-marketing-name">{{$m_arrWDFE.webdvr_evt_title}}</div>
                          </td>
                          <td><!--運送溫層-->
                              {{if $m_arrWDFE.prod_type == 3}}
                              <span class="admweb-v2-orderlist__badge--normal">常溫</span>
                              {{elseif $m_arrWDFE.prod_type == 10}}
                              <span class="admweb-v2-orderlist__badge--refrigeration">冷藏</span>
                              {{else}}
                              <span class="admweb-v2-orderlist__badge--freezing">冷凍</span>
                              {{/if}}
                          </td>
                          <td><!--運送方式-->
                              {{$m_arrWDFE.delivery_title}}
                          </td>
                          <td><!--活動時間-->
                              {{$m_arrWDFE.webdvr_evt_sdate}}~{{$m_arrWDFE.webdvr_evt_edate}}
                          </td>
                          <td><!--狀態-->
                              {{if $m_arrWDFE.webdvr_evt_status == 1}}
                              <span class="admweb-v2-marketing-tag-status-valid">有效</span>
                              {{else}}
                              <span class="admweb-v2-marketing-tag-status-invalid">無效</span>
                              {{/if}}
                          </td>
                      </tr>
                      <tr>
                          <td colspan="5">
                              <div class="pic-confirm-box pic-justify-content-flex-end pic-icon-margin-r pic-line-light15">
                                  <a class="admweb-v2-I-Btn pic-BgText-color-green pic-margin-r5"
                                     href="admweb.main.php?action=single_delivery_fee_edit_pic&timeCheck={{$m_arrSearch.timeCheck}}&webdvr_evt_uid={{$m_arrWDFE.webdvr_evt_uid}}">
                                      <i class="icons-line icon-line-edit"></i>編輯
                                  </a>
                              </div>
                          </td>
                      </tr>
                      </tbody>
                  </table>
              </li>
              {{/foreach}}
              {{if $m_arrWebsiteDeliveryFreeEventTotal<=$argument.items_per_page}}
              <!-- 頁碼a -->
              <div class="pic-text-center">
                  <p class="pic-page-bottom-text">{{$argument.data_from}} - {{$argument.data_to}} 筆／共 {{$m_arrWebsiteDeliveryFreeEventTotal}} 筆</p>
              </div>
              {{elseif $m_arrWebsiteDeliveryFreeEventTotal<=($argument.items_per_page*5)}}
              <!-- 頁碼b -->
              <div class="pic-flex-center pic-flex-center-column">
                  <ul class="admweb-v2-pagination">
                      {{$m_arrPage.pager_numeric}}
                  </ul>
                  <p class="admweb-v2-page-bottom-text">{{$argument.data_from}} - {{$argument.data_to}} 筆／共 {{$m_arrWebsiteDeliveryFreeEventTotal}} 筆</p>
              </div>
              {{else}}
              <!-- 頁碼c -->
              <div class="pic-flex-center pic-flex-center-column">
                  <ul class="admweb-v2-pagination">
                      {{$m_arrPage.pager_prev}}
                      {{$m_arrPage.pager_numeric}}
                      {{$m_arrPage.pager_next}}
                  </ul>
                  <p class="admweb-v2-page-bottom-text">{{$argument.data_from}} - {{$argument.data_to}} 筆／共 {{$m_arrWebsiteDeliveryFreeEventTotal}} 筆</p>
              </div>
              {{/if}}
              {{else}}
              <!-- 清單目前無活動資料 -->
              <div class="admweb-v2-NoData">
                  <div class="admweb-v2-img-BlacklistNoData"></div>
                  <span>目前無活動資料</span>
              </div>
              {{/if}}
          </ul>
      </div>
      <!-- 置底按鈕 -->
      <div class="admweb-v2-marketing-action" id="js-marketing-action">
          <button class="admweb-v2-marketing-action-row_btn iopen-icon-white-add-front"
                  onclick="window.location.href='admweb.main.php?action=single_delivery_fee_edit_pic&add_wdfe=1'">新增活動
          </button>
      </div>
  </div>
  <!-- 右側內容 End-->
</div>

<script>
    $(function (){
        // 頁籤套件
        var $switch_top = $('.swiper-wrapper .swiper-slide');
        $($switch_top.eq('{{$m_arrSearch.timeCheck-1}}').addClass('selected').find('swiper-slide'));
        $switch_top.click(function () {
            $(this).addClass('selected').siblings('.selected').removeClass('selected');
            changePage($(this).attr('timeCheck'));
        });

        // 呼叫函式
        // searchFormCollapse();
    });
  
  // 搜尋函式
  function searchFormCollapse() {
      const toggleBtn = document.getElementById('js-marketing-form-toggle--btn');
      const formEle = document.getElementsByClassName('js-marketing-form')[0];
      const formHeadEle = document.getElementsByClassName(
          'js-marketing-form-head-search'
      )[0];
      const defaultHeight = formHeadEle.clientHeight;
      const headBtn = document.getElementsByClassName(
          'js-marketing-form-head-search-btn'
      )[0];
      const wholeHeight = formEle.clientHeight;
      formEle.style.height = `${defaultHeight}px`;
      toggleBtn.addEventListener('click', () => {
          //當前為收合
          if (formEle.style.height === `${defaultHeight}px`) {
          formEle.style.height = `${wholeHeight}px`;
          toggleBtn.innerHTML =
              '收合進階條件<i class="icons-line icon-arrow-top-01"></i>';
          formHeadEle.style.gridTemplateColumns = 'auto 3fr';
          headBtn.style.display = 'none';
          } else {
          ///當前為展開
          formEle.style.height = `${defaultHeight}px`;
          toggleBtn.innerHTML =
              '更多進階條件 <i class="icons-line icon-arrow-down-01"></i>';
          formHeadEle.style.gridTemplateColumns = 'auto 1fr 84px';
          headBtn.style.display = 'block';
          }
      });
  }

    function changePage(timeCheck) {
        let divOutter = document.querySelector(".admweb-v2-marketing-list");
        divOutter.innerHTML = '';

        $.ajax({
            url:"",
            dataType:"json",
            type:"POST",
            async:false,
            data:{
                "myAct": "COMMAND_SEARCH",
                "timeCheck": timeCheck
            },
            success: function (result) {
                $("#total").text("共"+result.m_arrWebsiteDeliveryFreeEventTotal+"筆")

                if (result.m_arrWebsiteDeliveryFreeEventTotal > 0) {
                    result.m_arrWebsiteDeliveryFreeEvent.forEach(function (m_arrWDFE, i) {
                        let li = document.createElement("li");
                        li.className = "admweb-v2-marketing-card";
                        divOutter.appendChild(li);

                        let table = document.createElement("table");
                        table.className = "admweb-v2-marketing-table";
                        li.appendChild(table);

                        let theadHTML = `
                            <thead>
                                <tr class="admweb-v2-marketing-table-head">
                                    <th>活動名稱</th>
                                    <th>運送溫層</th>
                                    <th>運送方式</th>
                                    <th>活動時間</th>
                                    <th>狀態</th>
                                </tr>
                            </thead>
                        `;
                        table.innerHTML += theadHTML;

                        let tbody = document.createElement("tbody");
                        table.appendChild(tbody);

                        let td, div, a;

                        let tr1 = document.createElement("tr");
                        tr1.className = "admweb-v2-marketing-table-tr";
                        tbody.appendChild(tr1);

                        td = document.createElement("td");
                        tr1.appendChild(td);
                        div = document.createElement("div");
                        div.className = "admweb-v2-marketing-name";
                        div.textContent = m_arrWDFE.webdvr_evt_title;
                        td.appendChild(div);

                        // 溫層
                        td = document.createElement("td");
                        switch (m_arrWDFE.prod_type) {
                            case 3:
                                td.innerHTML = 
                                    `<span class="admweb-v2-orderlist__badge--normal">常溫</span>`;
                                break;
                            case 10:
                                td.innerHTML = 
                                    `<span class="admweb-v2-orderlist__badge--refrigeration">冷藏</span>`;
                                break;
                            default:
                                td.innerHTML = 
                                    `<span class="admweb-v2-orderlist__badge--freezing">冷凍</span>`;
                                break;
                        }
                        tr1.appendChild(td);

                        // 運送方式
                        td = document.createElement("td");
                        td.textContent = m_arrWDFE.delivery_title;
                        tr1.appendChild(td);

                        // 活動時間
                        td = document.createElement("td");
                        td.textContent = `${m_arrWDFE.webdvr_evt_sdate} ~ ${m_arrWDFE.webdvr_evt_edate}`;
                        tr1.appendChild(td);

                        // 狀態
                        td = document.createElement("td");
                        if (m_arrWDFE.webdvr_evt_status == 1) {
                            td.innerHTML = 
                                `<span class="admweb-v2-marketing-tag-status-valid">有效</span>`;
                        } else {
                            td.innerHTML = 
                                `<span class="admweb-v2-marketing-tag-status-invalid">無效</span>`;
                        }
                        tr1.appendChild(td);

                        // 按鈕
                        let tr2 = document.createElement("tr");
                        tbody.appendChild(tr2);

                        td = document.createElement("td");
                        td.colSpan = 5;
                        tr2.appendChild(td);
                        div = document.createElement("div");
                        div.className =
                            "pic-confirm-box pic-justify-content-flex-end pic-icon-margin-r pic-line-light15";
                        td.appendChild(div);
                        a = document.createElement("a");
                        a.className = "admweb-v2-I-Btn pic-BgText-color-green pic-margin-r5";
                        a.href = `admweb.main.php?action=single_delivery_fee_edit_pic&timeCheck=${timeCheck}`
                            + `&webdvr_evt_uid=${m_arrWDFE.webdvr_evt_uid}`;
                        a.innerHTML = `<i class="icons-line icon-line-edit"></i>編輯`;
                        div.appendChild(a);
                    });

                    // 分頁
                    let pageHtml;
                    let total = parseInt(result.m_arrWebsiteDeliveryFreeEventTotal);
                    let page = parseInt('{{$argument.page}}');
                    let items_per_page = parseInt('{{$argument.items_per_page}}');
                    let start = items_per_page * (page - 1) + 1;
                    let end = items_per_page * page;
                    let m_arrPage = result.m_arrPage;
                    if (total <= items_per_page) {
                        pageHtml = `
                            <div class="pic-text-center">
                                <p class="pic-page-bottom-text">${start} - ${end} 筆／共 ${total} 筆</p>
                            </div>
                        `;
                    } else if (total <= items_per_page * 5) {
                        pageHtml = `
                            <div class="pic-flex-center pic-flex-center-column">
                                <ul class="admweb-v2-pagination">
                                    ${filterScriptTags(m_arrPage.pager_numeric)}
                                </ul>
                                <p class="pic-page-bottom-text">${start} - ${end} 筆／共 ${total} 筆</p>
                            </div>
                        `;
                    } else {
                        pageHtml = `
                            <div class="pic-flex-center pic-flex-center-column">
                                <ul class="admweb-v2-pagination">
                                    ${filterScriptTags(m_arrPage.pager_prev)}
                                    ${filterScriptTags(m_arrPage.pager_numeric)}
                                    ${filterScriptTags(m_arrPage.pager_next)}
                                </ul>
                                <p class="pic-page-bottom-text">${start} - ${end} 筆／共 ${total} 筆</p>
                            </div>
                        `;
                    }
                    divOutter.insertAdjacentHTML('beforeend', pageHtml);

                } else {
                    divOutter.innerHTML = `
                        <div class="admweb-v2-NoData">
                            <div class="admweb-v2-img-BlacklistNoData"></div>
                            <span>目前無活動資料</span>
                        </div>
                    `;
                }
            }
        })
    }

    function filterScriptTags(input) {
        if (typeof input === 'string') {
            // 如果是字串，過濾 script 標籤及其內容
            return input.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
        } else if (Array.isArray(input)) {
            // 如果是陣列，遞迴處理每個元素
            return input.map(filterScriptTags);
        } else if (typeof input === 'object') {
            // 如果是物件，遞迴處理每個屬性值
            const sanitizedObject = {};
            for (const key in input) {
                sanitizedObject[key] = filterScriptTags(input[key]);
            }
            return sanitizedObject;
        } else {
            // 其他型態直接回傳
            return input;
        }
    }


</script>