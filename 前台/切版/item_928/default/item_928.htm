<style>
    .it928-default .it928-container{width: 100%; max-width: 1200px;padding: 10px;font-weight: 400;color:var(--pic-color-grey-100);display: flex;margin: 0 auto;}
    .it928-left .it928-category li{padding: 10px;line-height: 20px;}
    .it928-left .it928-category .it928-category-sm-2{padding: 10px 0;}
    .it928-left .it928-category li a{display: block;color: var(--pic-color-grey-100);font-size: 16px;}

    .it928-category-sm-2{ display: flex;justify-content: space-between; }
    .it928-left .it928-category-title-box{background: #fff;padding: 10px;}
    .it928-left{width: 25%;}
    .it928-left .it928-category-title{display: flex;justify-content: space-between;align-items: center;position: relative;padding:0;font-size: 16px;}
    .it928-left h1{font-weight: 400;font-size: 22px;line-height: 28px;    margin-bottom: 17px;}
    /* 右邊 */
    .it928-right .it928-arrows-down::after{display: inline-block;content: '';background: url(css/images/bbc/Icon-arrows-down-array.svg) no-repeat; height: 11px; width: 13px;margin-left: 5px;transition: 0.3s;}
    .it928-right{width: 75%;display: flex; flex-direction: column;}
    .it928-right .it928-sequence li.active .it928-arrows-down::after{display: inline-block;content: '';background: url(css/images/bbc/Icon-arrows-UpWhite-array.svg) no-repeat;height: 11px;width: 13px;margin-left: 5px;transition: 0.3s;}
    .it928-right .it928-sequence li.active .it928-arrows-up::after{display: inline-block;content: '';background: url(css/images/bbc/Icon-arrows-UpWhite-array.svg) no-repeat;transform: rotate(180deg);height: 11px;width: 13px;margin-left: 5px;transition: 0.3s;}
    .it928-right .it928-commodity{display: flex;flex-wrap: wrap; }
    .it928-right .it928-commodity li{margin:0;    padding: 0 12px;}
    .it928-right .it928-commodity .pic-shop-pds-default01{ width: 25%;}
    .it928-sequence{display: flex; background:var(--pic-color-grey-5);width: 100%;height: 56px;}
    
    .it928-right .it928-sequence li{display: flex;align-items: center;justify-content: center;width: auto; background: #fff; margin: 8px 5px;}
    .it928-right .it928-sequence li.active{background: #000000;color: #fff;}
    .it928-right .it928-sequence li.active a{color: #fff;}
    .it928-right .it928-sequence li a{color:var(--pic-color-grey-100);padding:0px 17px;font-size: 14px;}
    .it928-right li.it928-sequence-title{ background: #fff0;width: 46px;font-weight: 400;}
    .it928-right li.it928-sequence-title.active{background: var(--pic-color-grey-5);color: var(--pic-color-grey-100);}

    
    
    @media screen and (max-width:768px){
      .it928-right li.it928-sequence-title,.it928-left h1,.it928-category-btn{display: none;}
      /* 分類 */
      .it928-default .it928-container {flex-direction: column;padding: 0px;}
      .it928-left{width: 100%;}
      .it928-left .it928-category{display: flex;overflow-x: scroll;width: 100%;white-space: nowrap;border-top: 1px solid #EAEAEA; border-bottom: 1px solid #EAEAEA;margin-top: 5px;font-size: 16px;}
      .it928-left .it928-category li{margin: auto;padding: 10px 2.5px;}
      .it928-left .it928-category li a{background: #F8F8F8; font-size: 16px;padding: 8px; margin: auto;border-radius: 5px;}
      .it928-left .it928-category li.active a{background: #000;color: #fff;font-size: 16px;padding: 8px;}
      .it928-left .it928-category::-webkit-scrollbar{display: none;}
    
      /* 排序 */
      .it928-right .it928-arrows-down::after{margin-left: 4px;}
      .it928-right{width: 100%;}
      .it928-right .it928-sequence{background: #fff;}
      .it928-right .it928-sequence li{border-bottom: 1px solid #EAEAEA;margin: 8px 0px;width: 100%;}
      .it928-right .it928-sequence li.active{background: #fff; border-bottom: 2px #000 solid;}
      .it928-right .it928-sequence li.active .it928-arrows-down::after{display: inline-block;content: '';background: url(css/images/bbc/Icon-arrows-up-array.svg) no-repeat;height: 11px;width: 13px;margin-left: 5px;transition: 0.3s}
      .it928-right .it928-sequence li.active .it928-arrows-up::after{display: inline-block;content: '';background: url(css/images/bbc/Icon-arrows-up-array.svg) no-repeat;transform: rotate(180deg);height: 11px;width: 13px;margin-left: 5px;transition: 0.3s;}
      .it928-right .it928-sequence li.active a{color: #000;}
      .it928-right .it928-sequence li a{color:var(--pic-color-grey-100);padding: 0px 0px;font-size: 14px;}
      .it928-right .it928-commodity > li{margin:0;padding:0 12px;}
      .it928-right .it928-commodity .pic-shop-pds-default01{width: 50%;}
    }
    /**/
    </style>
    
    <div class="pic-default it928-default iopen-Set-Space">
        <div class="it928-container">
            <div class="it928-left">
                <h1>分類</h1>
                <div id="pic-list-1" class="it928-category-btn it928-category-title-box">
                    <div class="it928-category-title">
                        <div class="pic-flex-align-items">商店佈置</div>
                        <span class="pic-icon-black-arrows-rotate-right"></span>
                    </div>
                </div>
                <!-- 下拉功能選單 -->
                <div>
                    <ul class="it928-category">
                        <li>
                            <div id="it928-category-2"  class="it928-category-sm-2">
                                <a href="javascript:void(0);">所有商品</a>
                                <span class="pic-icon-black-arrows-rotate-right"></span>
                            </div>
                            <ul id="it928-category-content-2" class="it928-category pic-margin-l10" style="display: none;">
                                <li id="it928-category-3" class="it928-category-sm-2">
                                    <a href="javascript:void(0);">新鮮乳品-2</a>
                                    <span class="pic-icon-black-arrows-rotate-right"></span>
                                </li>
                                <div id="it928-category-content-3" class="it928-category-content" style="display: none;">
                                    <li><a href="javascript:void(0);">新鮮乳品-3</a></li>
                                    <li><a href="javascript:void(0);">新鮮乳品-4</a></li>
                                </div>
                            </ul>
                        </li>
                        <li><a href="javascript:void(0);">新鮮乳品</a></li>
                        <li><a href="javascript:void(0);">健康好食</a></li>
                        <li><a href="javascript:void(0);">免運套組</a></li>
                        <li><a href="javascript:void(0);">奶奶蛋菜大集合</a></li>
                        <li><a href="javascript:void(0);">羊羊好食光｜食材箱</a></li>
                    </ul>
                </div>
            </div>
    
            <div class="it928-right">
                <ul class="it928-sequence">
                    <li class="it928-sequence-title">排序</li>
                    <li class="{{if $smarty.get.order=='prod_view_count'}}active{{/if}}">
                        <a class="sort it928-arrows-down {{if $smarty.get.by!='ASC'}}it928-arrows-up{{/if}}"
                            href="{{$m_inURL}}&order=prod_view_count&by=" data-by="{{if $smarty.get.order=='prod_view_count' && $smarty.get.by=='DESC'}}ASC{{else}}DESC{{/if}}">
                            人氣
                        </a>
                    </li>
                    <li class="{{if $smarty.get.order=='prod_sales_count'}}active{{/if}}">
                        <a class="sort it928-arrows-down {{if $smarty.get.by!='ASC'}}it928-arrows-up{{/if}}"
                            href="{{$m_inURL}}&order=prod_sales_count&by=" data-by="{{if $smarty.get.order=='prod_sales_count' && $smarty.get.by=='DESC'}}ASC{{else}}DESC{{/if}}">
                            銷量
                        </a>
                    </li>
                    <li class="{{if $smarty.get.order=='create_date'}}active{{/if}}">
                        <a class="sort it928-arrows-down {{if $smarty.get.by!='ASC'}}it928-arrows-up{{/if}}"
                            href="{{$m_inURL}}&order=create_date&by=" data-by="{{if $smarty.get.order=='create_date' && $smarty.get.by=='DESC'}}ASC{{else}}DESC{{/if}}">
                            新上市
                        </a>
                    </li>
                    <li class="{{if $smarty.get.order=='selling_price'}}active{{/if}}">
                        <a class="sort it928-arrows-down {{if $smarty.get.by!='ASC'}}it928-arrows-up{{/if}}"
                            href="{{$m_inURL}}&order=selling_price&by=" data-by="{{if $smarty.get.order=='selling_price' && $smarty.get.by=='DESC'}}ASC{{else}}DESC{{/if}}">
                            價錢
                        </a>
                    </li>
                </ul>
  
     <!-- 商品塞這裡 -->

    <ul id="" class="it928-commodity pic-margin-t25">
      <li class="pic-shop-pds-default01">
        <div class="pic-shop-pds-imgbox pic-shop-pds-stock-block"><!--缺貨時增加class name pic-shop-pds-stock-block-->
            <div class="pic-shop-pds-stock"><span>補貨中</span></div><!-- 缺貨才要顯示 -->
            <!-- <div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">75</span><span>折</span></div> --> <!-- 折扣才要顯示 -->                                                                          
            <a href="#" title="商品名稱"><img src="https://picsum.photos/220/220/?random=1" alt="商品名稱"></a>
        </div>
        <div class="pic-shop-pds-infobox">
            <h2><a href="#">商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱</a></h2>
            <div class="pic-shop-pds-bottom">
                <div class="pic-shop-pds-price">
                    <ul>
                        <li class="pic-shop-pds-price_01">$100000</li>
                        <li class="pic-shop-pds-price_02"><span>$</span>1999</li>
                    </ul>
                </div>
                <div class="pic-shop-pds-btn">
                  <div class="pic-shop-pds-addlist"><a href="javascript:void(0);" title="加入追蹤清單">加入追蹤清單</a></div> <!--已追蹤增加class name active-->
                  <div class="pic-shop-pds-addcart"><a href="javascript:void(0);" title="加入購物車">加入購物車</a></div>
                </div>
          </div>
        </div>
    </li>
    <li class="pic-shop-pds-default01">
        <div class="pic-shop-pds-imgbox pic-shop-pds-stock-block"><!--缺貨時增加class name pic-shop-pds-stock-block-->
            <div class="pic-shop-pds-stock"><span>補貨中</span></div><!-- 缺貨才要顯示 -->
            <!-- <div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">75</span><span>折</span></div> --> <!-- 折扣才要顯示 -->                                                                          
            <a href="#" title="商品名稱"><img src="https://picsum.photos/220/220/?random=1" alt="商品名稱"></a>
        </div>
        <div class="pic-shop-pds-infobox">
            <h2><a href="#">商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱</a></h2>
            <div class="pic-shop-pds-bottom">
                <div class="pic-shop-pds-price">
                    <ul>
                        <li class="pic-shop-pds-price_01">$100000</li>
                        <li class="pic-shop-pds-price_02"><span>$</span>1999</li>
                    </ul>
                </div>
                <div class="pic-shop-pds-btn">
                  <div class="pic-shop-pds-addlist"><a href="javascript:void(0);" title="加入追蹤清單">加入追蹤清單</a></div> <!--已追蹤增加class name active-->
                  <div class="pic-shop-pds-addcart"><a href="javascript:void(0);" title="加入購物車">加入購物車</a></div>
                </div>
          </div>
        </div>
    </li>
    <li class="pic-shop-pds-default01">
        <div class="pic-shop-pds-imgbox pic-shop-pds-stock-block"><!--缺貨時增加class name pic-shop-pds-stock-block-->
            <div class="pic-shop-pds-stock"><span>補貨中</span></div><!-- 缺貨才要顯示 -->
            <!-- <div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">75</span><span>折</span></div> --> <!-- 折扣才要顯示 -->                                                                          
            <a href="#" title="商品名稱"><img src="https://picsum.photos/220/220/?random=1" alt="商品名稱"></a>
        </div>
        <div class="pic-shop-pds-infobox">
            <h2><a href="#">商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱</a></h2>
            <div class="pic-shop-pds-bottom">
                <div class="pic-shop-pds-price">
                    <ul>
                        <li class="pic-shop-pds-price_01">$100000</li>
                        <li class="pic-shop-pds-price_02"><span>$</span>1999</li>
                    </ul>
                </div>
                <div class="pic-shop-pds-btn">
                  <div class="pic-shop-pds-addlist"><a href="javascript:void(0);" title="加入追蹤清單">加入追蹤清單</a></div> <!--已追蹤增加class name active-->
                  <div class="pic-shop-pds-addcart"><a href="javascript:void(0);" title="加入購物車">加入購物車</a></div>
                </div>
          </div>
        </div>
    </li>
    <li class="pic-shop-pds-default01">
        <div class="pic-shop-pds-imgbox pic-shop-pds-stock-block"><!--缺貨時增加class name pic-shop-pds-stock-block-->
            <div class="pic-shop-pds-stock"><span>補貨中</span></div><!-- 缺貨才要顯示 -->
            <!-- <div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">75</span><span>折</span></div> --> <!-- 折扣才要顯示 -->                                                                          
            <a href="#" title="商品名稱"><img src="https://picsum.photos/220/220/?random=1" alt="商品名稱"></a>
        </div>
        <div class="pic-shop-pds-infobox">
            <h2><a href="#">商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱</a></h2>
            <div class="pic-shop-pds-bottom">
                <div class="pic-shop-pds-price">
                    <ul>
                        <li class="pic-shop-pds-price_01">$100000</li>
                        <li class="pic-shop-pds-price_02"><span>$</span>1999</li>
                    </ul>
                </div>
                <div class="pic-shop-pds-btn">
                  <div class="pic-shop-pds-addlist"><a href="javascript:void(0);" title="加入追蹤清單">加入追蹤清單</a></div> <!--已追蹤增加class name active-->
                  <div class="pic-shop-pds-addcart"><a href="javascript:void(0);" title="加入購物車">加入購物車</a></div>
                </div>
          </div>
        </div>
    </li>
    <li class="pic-shop-pds-default01">
        <div class="pic-shop-pds-imgbox pic-shop-pds-stock-block"><!--缺貨時增加class name pic-shop-pds-stock-block-->
            <div class="pic-shop-pds-stock"><span>補貨中</span></div><!-- 缺貨才要顯示 -->
            <!-- <div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">75</span><span>折</span></div> --> <!-- 折扣才要顯示 -->                                                                          
            <a href="#" title="商品名稱"><img src="https://picsum.photos/220/220/?random=1" alt="商品名稱"></a>
        </div>
        <div class="pic-shop-pds-infobox">
            <h2><a href="#">商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱</a></h2>
            <div class="pic-shop-pds-bottom">
                <div class="pic-shop-pds-price">
                    <ul>
                        <li class="pic-shop-pds-price_01">$100000</li>
                        <li class="pic-shop-pds-price_02"><span>$</span>1999</li>
                    </ul>
                </div>
                <div class="pic-shop-pds-btn">
                  <div class="pic-shop-pds-addlist"><a href="javascript:void(0);" title="加入追蹤清單">加入追蹤清單</a></div> <!--已追蹤增加class name active-->
                  <div class="pic-shop-pds-addcart"><a href="javascript:void(0);" title="加入購物車">加入購物車</a></div>
                </div>
          </div>
        </div>
    </li>
    <li class="pic-shop-pds-default01">
        <div class="pic-shop-pds-imgbox pic-shop-pds-stock-block"><!--缺貨時增加class name pic-shop-pds-stock-block-->
            <div class="pic-shop-pds-stock"><span>補貨中</span></div><!-- 缺貨才要顯示 -->
            <!-- <div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">75</span><span>折</span></div> --> <!-- 折扣才要顯示 -->                                                                          
            <a href="#" title="商品名稱"><img src="https://picsum.photos/220/220/?random=1" alt="商品名稱"></a>
        </div>
        <div class="pic-shop-pds-infobox">
            <h2><a href="#">商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱商品名稱</a></h2>
            <div class="pic-shop-pds-bottom">
                <div class="pic-shop-pds-price">
                    <ul>
                        <li class="pic-shop-pds-price_01">$100000</li>
                        <li class="pic-shop-pds-price_02"><span>$</span>1999</li>
                    </ul>
                </div>
                <div class="pic-shop-pds-btn">
                  <div class="pic-shop-pds-addlist"><a href="javascript:void(0);" title="加入追蹤清單">加入追蹤清單</a></div> <!--已追蹤增加class name active-->
                  <div class="pic-shop-pds-addcart"><a href="javascript:void(0);" title="加入購物車">加入購物車</a></div>
                </div>
          </div>
        </div>
    </li>
</ul>

      <!-- 商品塞這裡 END -->
            </div>
        </div>
    
  
    </div>
    <!-- art -->


    <script>
$("#it928-category-2").click(function () {
    $('#it928-category-content-2').slideToggle();
    $('#it928-category-2 .pic-icon-black-arrows-rotate-right').toggleClass("pic-arrows-rotate");
  })
$("#it928-category-3").click(function () {
    $('#it928-category-content-3').slideToggle();
    $('#it928-category-3 .pic-icon-black-arrows-rotate-right').toggleClass("pic-arrows-rotate");
  })

    </script>

    
    <!-- 丟變數出來看 commit前刪除 -->
    <script>
        console.log(111, 'it928_arrProduct', {{ $it928_arrProduct|@json_encode}});
        console.log(112, 'm_arrPageItem', {{ $m_arrPageItem|@json_encode}});
    </script>
    

    
    
    <script>
        $(function () {
        var $sort = $('.it928-category li');
            // $($sort.eq(0).addClass('active').find('a'));
            $sort.click(function () {
                $(this).addClass('active').siblings('.active').removeClass('active');
            });
        });
    
        // 排序按鈕 重組url
        $(".it928-sequence li a.sort").click(function (e) {
            let url = $(this).attr('href')+$(this).data('by');
            console.log($(this).attr('class'), $(this).attr('href'), $(this).data('by'), url)
            $(this).attr('href',url)
        })
    
        function more_product(){
            let data = {
                myAct: 'MORE_PRODUCT',
                start: start,
                {{$nocsrfTokenId}}:'{{$nocsrfToken}}'
            };
            $.ajax({
                type: "post",
                url: "",
                data: data,
                dataType: "json",
                success: function (re) {
                    console.log('more_product','success',re)   
                    $.each(re, function (idx, val) { 
                        let htm = get_product_htm(val);
                        $('#product_ul').append(`${htm}`);
                    }); 
                },
                error: function (re) {
                    console.log('more_product','error',re)    
                }
            });
        }
    
    
        // 轉換千分位
        function number_comma(num){
            let comma=/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g
            return num.toString().replace(comma, ',')
        }
    
        // 取欄位寬度
        {{if !$mobileDeviceDirected}}
        const column_with = "{{math equation='100/x' x=$m_arrPageItem.wpitem_prod_col}}";
        {{else}}
        const column_with = "{{math equation='100/x' x=$m_arrPageItem.wpitem_prod_col_mobile}}";
        {{/if}}
    
        // 組合 ajax load 的 product item html
        function get_product_htm(prod){
            // console.log('get_product_htm',prod)
    
            let pic_pds_imgbox = '<div class="pic-pds-imgbox">';
            let pic_pds_stock = '';
            let pic_pds_discount_tag = '';
            let pic_pds_btn = '';
            let trace_active = '';
            let price_01 = '';
            let addcart = '';
            let addcar_top = '';
            let addcar_box_deta = '';
            let limit_buy_pa = (prod.prod_limit_buy>0 || prod.prod_limit_buy_alltime>0)? "1" : "0";
            let now = new Date();
    
    
            // 檢查庫存
            if((prod.prod_stock-prod.prod_safety_stock)<=0){
                pic_pds_imgbox = '<div class="pic-pds-imgbox pic-pds-stock-block">';
                pic_pds_stock = `<a href="${prod.prod_url}"><div class="pic-pds-stock" onclick="window.location.href='${prod.prod_url}';"><span>補貨中</span></div></a>`;
            }
    
            // 檢查折扣
            // 顯示原價
            let selling_price = parseInt(prod.selling_price)
            let prod_sticker_price = parseInt(prod.prod_sticker_price)
            if( selling_price < prod_sticker_price){
                let discount_num = Math.round(selling_price*100/prod_sticker_price);
                if(discount_num%10 == 0) discount_num = discount_num/10;
    
                pic_pds_discount_tag = `<div class="pic_pds_discount_tag"><span class="pic_pds_discount_number">${discount_num}</span><span>折</span></div>`;
                price_01 = `<li class="pic-pds-price_01">$${number_comma(prod.prod_sticker_price)}</li>`;
            }
    
    
            {{if !$mobileDeviceDirected}}{{*手機版無此版位*}}
            let prod_market_sdate = new Date(prod.prod_market_sdate);
            let prod_market_edate = new Date(prod.prod_market_edate);
    
            if(prod.trace_uid!=null) trace_active = " active";
    
            if(prod_market_sdate <= now && prod_market_edate >=now && prod.prod_marketing){
                // 九大行銷
                if(prod.webMarketing || prod.discount_range_setting.methods){
                    addcart = `<div class="pic-pds-addcart"><a class="cart_light_box" href="#marketing_${prod.prod_uid}" title="加入購物車">加入購物車</a></div>`;
                    addcar_top= `<div class="addcar_top">此商品適用下列優惠，請點選連結至活動頁選購</div>`;
                }else if(prod.prod_limit_sale == '0' && prod.prod_shopping_cart_mode == '1'){
                    addcart = `<div class="pic-pds-addcart"><a href="javascript:void(0);" title="直接購買" onclick="buyNowBBC('${prod.prod_no}','{{$sys_arrWebsite.web_byeurl}}')">直接購買</a></div>`;
                }else if(prod.prod_limit_sale == '0'){
                    addcart = `<div class="pic-pds-addcart"><a href="javascript:void(0);" title="加入購物車" onclick="goCartMainBBC('${prod.prod_no}','{{$sys_arrWebsite.web_byeurl}}',${limit_buy_pa}">加入購物車</a></div>`;
                }
            }
                
            pic_pds_btn =`
            <div class="pic-pds-btn">
                <div class="pic-pds-addlist addlist_${prod.prod_uid}${trace_active}"><a href="javascript:void(0);" title="加入追蹤清單" onclick="add2traceBBC('${prod.prod_uid}','${prod.prod_no}','${prod.selling_price}')">加入追蹤清單</a></div>
                ${addcart}            
            </div>`;
            {{/if}}
    
            // `<li id="product_uid_${prod.prod_uid}" price="${prod.selling_price}"
            //     style="width:${column_with}%;float:left; margin-left:0px; margin-right:0px;">
    
            let htm = 
            `<li>
            <div class="pic-pds-default01" style="height: 343px;">
                ${pic_pds_imgbox}
                    ${pic_pds_stock} ${pic_pds_discount_tag}${pic_pds_btn}
                    <a href="${prod.prod_url}" title="${prod.prod_name}"><img src="${prod.prod_file}" alt="${prod.prod_name}"></a>
                </div>
                <div class="pic-pds-infobox">
                    <h2><a href="${prod.prod_url}">${prod.prod_name}</a></h2>
                    <div class="pic-pds-price">
                        <ul>
                            <li class="pic-pds-price_02"><span>$</span>${number_comma(prod.selling_price)}</li>
                            ${price_01}
                            <li>${prod.prod_is_top} - ${prod.prod_view_count} - ${prod.prod_sales_count}<br>${prod.create_date} - ${prod.selling_price}</li>
                        </ul>
                    </div>
                </div>
            </div></li>`;
    
            {{if !$mobileDeviceDirected}}{{*手機版無此版位*}}
            // 組合九大行銷 light box
            if(prod.discount_range_setting.methods){
                addcar_box_deta = `
                <div class="addcar_box_deta jooshop_btn_color">
                    <p><span class="highlight_cheap">${prod.discount_range_setting.best_methods.discount_pct}折</span>
                        此商品 最低價${prod.discount_range_setting.best_methods.price_per}元起</p>
                    <a href="${prod.prod_url}">前往商品頁</a>
                </div>
                `;
            }
    
            // 九大行銷 light box
            if(prod.webMarketing || prod.discount_range_setting.methods){
    
                htm += `
                <div class="setP_stagingBoxIn jooshop_addcar_box" id="marketing_${prod.prod_uid}" style="display: none;">
                    <div class="addcar_box">${addcar_top}${addcar_box_deta}`;
                
                for (let i = 0; i < prod.webMarketing.length; i++) {
                    const arrMkt = prod.webMarketing[i];
                    htm += `
                    <div class="addcar_box_deta jooshop_btn_color"><p>${arrMkt.wmkt_title}</p>
                        <a href="../{{$sys_arrWebsite.web_byeurl}}/index.php?action=website_marketing&wmkt_uid=${arrMkt.wmkt_uid}">
                        {{$lang.root.product_detail.5}}<!--前往活動頁--></a></div>`;                
                }
                htm += `</div>`;
                
                if(prod.prod_limit_sale!=1){
                    htm += `
                    <div class="tbs_seemore jooshop_btn_color">
                        <a href="javascript:void(0);"
                        onclick="javascript:closeBoxBBC('${prod.prod_no}','{{$sys_arrWebsite.web_byeurl}}','${prod.prod_shopping_cart_mode}}',${limit_buy_pa};">
                        不需優惠，直接加入購物車</a>
                        </div>`;
                }
    
                htm += `</div>`;
    
            }
            {{/if}}
            return htm;
        }
    
        // 離開網頁前 => 清除本頁session
        window.addEventListener('beforeunload', function (event) {
            $.ajax({
                type: "get",
                url: "",
                async: true,
                data: {
                    myAct: 'CLEAR_IT928',
                    {{$nocsrfTokenId}}:'{{$nocsrfToken}}'
                },
                dataType: "json",
                success: function (re) {
                    // console.log('CLEAR_IT928','success',re)   
                },
                error: function (re) {
                    // console.log('CLEAR_IT928','error',re)    
                }
            });
        });
    
        let start = 8
        const limit = 8
    
      // 偵測滑動 Ajax讀圖片
      $(window).load(function () {
            let win_h = $(window).height();
            let prod_ul_h = $('#product_ul>li').last().offset().top + $('#product_ul>li').last().height() - $('#product_ul>li').first().offset().top
            let prod_ul_bottom = $('#product_ul>li').last().offset().top + $('#product_ul>li').last().height()
    
            $(document).scroll(function () { 
          let body_top = 0;
          if (typeof window.pageYOffset != "undefined") {
            body_top = window.pageYOffset;		
          } else if (typeof document.compatMode != "undefined"
                && document.compatMode != "BackCompat") {
            body_top = document.documentElement.scrollTop;
          } else if (typeof document.body != "undefined") {
            body_top = document.body.scrollTop;
          }
    
          delta = prod_ul_bottom - (body_top + win_h) ;
          
                if(delta <0){
                    more_product();
                    start += limit;
                    prod_ul_bottom += prod_ul_h;
          }
        });
      });
    
    
    </script>